

### ESlint、Prettier、TypeScript

```sh
npm i -D eslint @typescript-eslint/parser  eslint-plugin-react
npm i -D prettier eslint-config-prettier eslint-plugin-prettier
```

- eslint: ESLint的核心代码
- @typescript-eslint/parser：ESLint的解析器，用于解析typescript，从而检查和规范Typescript代码
- @typescript-eslint/eslint-plugin：这是一个ESLint插件，包含了各类定义好的检测Typescript代码的规范，eslint-plugin-prettier已覆盖，无需安装
- eslint-plugin-react：支持React语法的ESlint插件



- prettier：prettier 插件的核心代码

- eslint-config-prettier：解决ESLint中的样式规范和prettier中样式规范的冲突，以prettier的样式规范为准，使ESLint中的样式规范自动失效。

- eslint-plugin-prettier：将prettier的规则作为ESLint规则来使用，因此需要安装 prettier

  > [eslint-config-prettier](https://github.com/prettier/eslint-config-prettier/blob/6537dd961a7b612d6104017234024f241c2b7591/CHANGELOG.md)
  >
  > Changed: All configs have been merged into one!
  >
  > To upgrade, change:
  >
  > ```js
  > {
  >     "extends": [
  >        "some-other-config-you-use",
  >        "prettier",
  >        "prettier/@typescript-eslint",
  >        "prettier/babel",
  >        "prettier/flowtype",
  >        "prettier/react",
  >        "prettier/standard",
  >        "prettier/unicorn",
  >        "prettier/vue"
  >     ]
  > }
  > ```
  >
  > Into:
  >
  > ```js
  > {
  >     "extends": [
  >        "some-other-config-you-use",
  >        "prettier"
  >     ]
  > }
  > ```
  >
  > If you use [eslint-plugin-prettier](https://github.com/prettier/eslint-plugin-prettier), all you need is [plugin:prettier/recommended](https://github.com/prettier/eslint-plugin-prettier#recommended-configuration):
  >
  > ```js
  > {
  >     "extends": [
  >        "some-other-config-you-use",
  >        "plugin:prettier/recommended"
  >     ]
  > }
  > ```



#### .eslintrc.js 常用配置

[rules](https://eslint.bootcss.com/docs/rules/)

```js
module.exports = {
    parser:  '@typescript-eslint/parser', //定义ESLint的解析器
    // extends可省略前缀 eslint-config-
    // plugins可省略前缀 eslint-plugin-
    // extends使用插件导出的config，删掉插件前缀后加上前缀plugin:
    extends: [ // 继承的规则，后面覆盖前面
      'plugin:react/recommended', 
      'plugin:prettier/recommended',
    ],
    plugins: [
      // plugin:prettier/recommended 的 config 已包含
      // "react",
      // '@typescript-eslint',
    ],
	  parserOptions: {  // 解析器选项
      "ecmaVersion": 2019, // 支持 ES6 语法并不意味着同时支持新的 ES6 全局变量或类型（比如 Set 等新类型），需{ "env":{ "es6": true } }
      "sourceType": "module", //  "script" (默认)，如果代码是 ECMAScript 模块，设置为"module"
      "ecmaFeatures": {
        "jsx": true
      }
    },
    env:{                          // 指定代码的运行环境
        browser: true,
      	es6:true,
        node: true,
    },
    globals:{
       "var1": "writable",
       "var2": "readonly",
       "var3": "off", // 禁用
    },
  	settings: {             
      	// eslint-plugin-react要求：https://www.npmjs.com/package/eslint-plugin-react
        "react": {
            "pragma": "React",
            "version": "detect"
        }
    }, 
    // 扩展（或覆盖）规则
    rules: {},
    // 覆盖指定文件类型的rules
    overrides: [
      {
            "files": ["./src/**/*.html"],
            "rules": {
                
            }
        }
    ]
}
```

#### .prettierrc.js 常用配置

https://prettier.io/docs/en/options.html

可以查看vscode 设置->扩展-> prettier，中文解释

```js
module.exports = {
  "printWidth": 120, // 行长
  "tabWidth": 2, // 缩进长度
  "useTabs": false, //使用空格代替tab缩进
  "semi": true, // 结尾分号
  "singleQuote": true, // 单引号，jsx忽略此选项，请使用 jsxSingleQuote
  "quoteProps": "preserve", // <as-needed|consistent|preserve> 是否给对象属性加引号 preserve：保留编程时的状态
  "jsxSingleQuote": false, // jsx中使用单引号
  "trailingComma": "all", // <es5|none|all> 在对象或数组最后一个元素后面是否加逗号。all 尽可能尾随逗号
  "bracketSpacing": true, //在对象前后添加空格-eg: { foo: bar }
  "bracketSameLine": false, // 多属性html、jsx标签的‘>’折行放置
  "arrowParens": "avoid", // <always|avoid> avoid：单参数箭头函数参数不使用圆括号
  "endOfLine": 'lf', //结束行形式
  "embeddedLanguageFormatting": 'auto', //对引用代码进行格式化
  "overrides": []
};
```

**.eslintignore**

glob模式

ESLint总是忽略 `/node_modules/*` 和 `/bower_components/*` 中的文件。

```
dist
!build/index.js
```

如果相比于当前工作目录下 `.eslintignore` 文件，你更想使用一个不同的文件，你可以在命令行使用 `--ignore-path` 选项指定它。例如，你可以使用 `.jshintignore` 文件，因为它有相同的格式：

```
eslint --ignore-path .jshintignore file.js
```

你也可以使用你的 `.gitignore` 文件：

```
eslint --ignore-path .gitignore file.js
```

任何文件只要满足标准忽略文件格式都可以用。记住，指定 `--ignore-path` 意味着任何现有的 `.eslintignore` 文件将不被使用。请注意，`.eslintignore` 中的匹配规则比 `.gitignore` 中的更严格。****

**.prettierignore**

如果没有用 prettier 或 插件去修改，可以不用该文件

```
dist
!build/index.js
node_moduls
```

#### extends和plugins的区别

##### plugins

plugin插件主要是为eslint新增一些检查规则，引入 plugin 可以理解为只是加载了插件，引入了额外的 自定义的rules。需要在 rules、extends 中定义后才会生效，如果没有则不生效。

plugin里不仅包括自定义的rules，还可以配置config，类似配置好的.eslintrc.js，因此这部分可以在extends里配置：plugin:config名称。

##### extends

extends可以看做是集成一个个配置方案的最佳实践。它配置的内容实际就是一份份别人配置好的.eslintrc.js。

允许 extends 配置多个模块，如果规则冲突，位置靠后的包将覆盖前面的。rules 中的规则相同，并且优先级恒定高于 extends，类似class的extends，支持多继承。

**命名规范**

extends 的模块名称以 eslint-config- 开头，例如 eslint-config-myconfig。也支持 npm 作用域模块，例如 ： @scope/eslint-config 或 @scope/eslint-config-myconfig） 。使用的时候可以用全称（slint-config-myconfig），也可以用缩写（myconfig）。

如果 extends 引用了 plugin 的config，plugins 中会自动引入该plugin，即使 plugins 没有显式声明。

[You have done it correctly.](https://stackoverflow.com/questions/61528185/eslint-extends-vs-plugins-v2020)

For your example, there are 2 ways to do add `typescript-eslint`...

- 1st way:

```js
{
  parser: "@typescript-eslint/parser",
  parserOptions: { sourceType: "module" },
  plugins: ["@typescript-eslint"],
  extends: [],
  rules: {
    "@typescript-eslint/explicit-function-return-type": [
      "error",
      {
        allowExpressions: true
      }
    ]
  }
}
```

- 2nd way:

```js
{
  plugins: [],
  extends: ["plugin:@typescript-eslint/recommended"],
  rules: {
    "@typescript-eslint/explicit-function-return-type": [
      "error",
      {
        allowExpressions: true
      }
    ]
  }
}
```

The difference is...

- 1st way:
  - `parser`, `parserOptions` and `plugins` are manually added,
  - Only `@typescript-eslint/explicit-function-return-type` is enforced.
- 2nd way:
  - `plugin:@typescript-eslint/recommended` has automatically added `parser`, `parserOptions` and `plugins`.  extends引用了plugin的config，即使plugins中没有显式引入，也会自动引入
  - `@typescript-eslint/explicit-function-return-type` is augmented and enforced.

#### rules

**优先级最高**

- `"off"` 或 `0` - 关闭规则
- `"warn"` 或 `1` - 开启规则，使用警告级别的错误：`warn` (不会导致程序退出)
- `"error"` 或 `2` - 开启规则，使用错误级别的错误：`error` (当被触发的时候，程序会退出)

`rules` 属性可以做下面的任何事情以扩展（或覆盖）规则：

- 启用额外的规则
- 改变继承的规则级别而不改变它的选项：
  - 基础配置：`"eqeqeq": ["error", "allow-null"]`  三等于号
  - 派生的配置：`"eqeqeq": "warn"`
  - 最后生成的配置：`"eqeqeq": ["warn", "allow-null"]`
- 覆盖基础配置中的规则的选项
  - 基础配置：`"quotes": ["error", "single", "avoid-escape"]`
  - 派生的配置：`"quotes": ["error", "single"]`
  - 最后生成的配置：`"quotes": ["error", "single"]`

基础配置：数组类型，派生配置：字符串类型，最后类型：覆盖数组第一项，"error"和"warn"是同一类型，都是放在数组第一位。如果派生配置是`"eqeqeq": "always"`，则最后类型：`"eqeqeq": ["warn", "always"]`

基础配置：数组类型，派生配置：数组类型，最后类型：覆盖数组。

.

### .vscode/settings.json

下载 vscode的ESlint、prettier 插件

添加 eslint、prettier 规则

 vscode的ESlint 插件会优先执行`.eslintrc.js`文件的配置。prettier 同理。



### editorconfig

vscode下载**EditorConfig for VS Code**插件

通配符

```
*                匹配除/之外的任意字符串
**               匹配任意字符串
?                匹配任意单个字符
[name]           匹配name中的任意一个单一字符
[!name]          匹配不存在name中的任意一个单一字符
{s1,s2,s3}       匹配给定的字符串中的任意一个(用逗号分隔) 
{num1..num2}   　匹配num1到num2之间的任意一个整数, 这里的num1和num2可以为正整数也可以为负整数
```

配置选项

```
root = true                         # 根目录的配置文件，编辑器会由当前目录向上查找，如果找到 `roor = true` 的文件，则不再查找

[*]                                 # 匹配所有的文件
indent_style = space                # 空格缩进
indent_size = 4                     # 缩进空格为4个
end_of_line = lf                    # 文件换行符是 linux 的 `\n`
charset = utf-8                     # 文件编码是 utf-8
trim_trailing_whitespace = true     # 不保留行末的空格
insert_final_newline = true         # 文件末尾添加一个空行
curly_bracket_next_line = false     # 大括号不另起一行
spaces_around_operators = true      # 运算符两遍都有空格
indent_brace_style = 1tbs           # 条件语句格式是 1tbs
spaces_around_brackets              # 表示括号和括号之间应有空格：无空格，仅在括号内，仅在括号外或在括号的两侧 （none，inside，outside，both）
max_line_length                     # 在指定的字符数后强制换行。off关闭此功能
[*.js]                              # 对所有的 js 文件生效
quote_type = single                 # 字符串使用单引号

[*.{html,less,css,json}]            # 对所有 html, less, css, json 文件生效
quote_type = double                 # 字符串使用双引号

[package.json]                      # 对 package.json 生效
indent_size = 2                     # 使用2个空格缩进
```

常用配置

```
# http://editorconfig.org
# root: 表明是最顶层的配置文件，发现设为true时，才会停止查找.editorconfig文件。
root = true

[*]
# 文件编码
charset = utf-8
# 使用单引号
quote_type = single
# 换行符格式
end_of_line = lf
# 缩进数量
indent_size = 2
# 缩进类型
indent_style = tab
# 行最大长度，要和.prettierrc.js保持一致
max_line_length = 120
# 删除末尾空格
trim_trailing_whitespace = true
# 结尾插入新行
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false

[*.{html,css,less,scss,json}]       # 对所有 html,css,less,scss,json 文件生效
quote_type = double                 # 字符串使用双引号

# Makefile文件中要用tab缩进，这个确实是历史遗留问题，用空格缩进会出错。
[Makefile]
indent_style = tab
```



### stylelint

CSS语法规则和风格检测工具



### 代码提交前检查

```sh
npm install husky lint-staged --save-dev
```

> husky 或 yorkie 可以让我们向项目中方便添加git hooks。
>
> lint-staged 是一个由glob模式在git暂存文件上运行linters的工具。
>
> Lint 这个单词的本意就是衣服上的棉球，通过 Linting 这个单词的意思就是去除代码中可能存在问题的意思。

[ESlint命令行](https://eslint.cn/docs/user-guide/command-line-interface)

```
--ext 指定JavaScript文件扩展名-默认值：.js
--fix 自动修复问题
```

**package.json**

```json
"scripts":{
	"lint": "lint-staged",
}
"husky": {
   "hooks": {
      "pre-commit": "lint-staged"
    }
},
"lint-staged": {
   "**/*.js": "eslint --ext .js",  
   "**/*.vue": "eslint --ext .vue",  // 可能需要安装eslint-plugin-vue
   "src/**/*.{js,vue}": [
     "prettier --write",
     "eslint  --fix",
     // "git add"  // 从v10.0.0开始，对最初暂存文件的任何新修改都将自动添加到提交中。如果您的任务以前包含git add步骤，请删除此步骤。自动行为可确保竞争条件较少，因为尝试同时运行多个git操作通常会导致错误。
   ]
},
```

或

```json
"scripts":{
	"lint": "eslint src --fix --ext .js,.jsx,.ts,.tsx",
},
"husky": {
   "hooks": {
      "pre-commit": "npm run lint-staged"
    }
},
"lint-staged": {
  "src/**":[
    "npm run lint"
  ]
}
```

或

```sh
npm install yorkie --save-dev
```

```json
"scripts":{
	"lint": "eslint src --fix --ext .js,.jsx,.ts,.tsx",
},
"gitHooks": {
    "pre-commit": "lint-staged"
},
"lint-staged": {
  "src/**":[
    "npm run lint"
  ]
}
```

- **commitlint**
  - commit 信息校验工具
- **commitizen**
- 辅助 commit 信息 ,就像这样,通过选择输入,规范提交信息
